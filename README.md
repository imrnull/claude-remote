# Claude Remote Scripts

Shell scripts for orchestrating Claude Code sessions remotely via n8n workflows. Clone repositories, create branches, and run Claude Code with persistent sessions.

## Quick Start

```bash
# New session - folder doesn't exist, will clone and create branch
./bin/benji-init.sh \
  "550e8400-e29b-41d4-a716-446655440000" \
  "git@github.com:org/repo.git" \
  "/path/to/workspaces" \
  "BP25-123" \
  "BP25-123 - " \
  "Add a dark mode toggle to the settings page"

# Continuation - folder exists, will resume session
./bin/benji-init.sh \
  "550e8400-e29b-41d4-a716-446655440000" \
  "git@github.com:org/repo.git" \
  "/path/to/workspaces" \
  "BP25-123" \
  "BP25-123 - " \
  "Use CSS variables for the theme colors"
```

## Arguments

| Position | Name | Required | Description |
|----------|------|----------|-------------|
| $1 | CHAT_ID | Yes | UUID for the session (generated by n8n) |
| $2 | REPO_URL | Yes | SSH git URL (e.g., `git@github.com:org/repo.git`) |
| $3 | WORK_BASE_DIR | Yes | Base directory for working directories |
| $4 | BRANCH_NAME | Yes | Branch identifier (e.g., `BP25-123` or `add-search-filter`) |
| $5 | COMMIT_PREFIX | No | Prefix for commits (e.g., `"BP25-123 - "`) or empty `""` |
| $6 | PROMPT | Yes | Task description (new) or user response (continuation) |

## Output

All scripts output JSON to stdout. Debug logs go to stderr only when `DEBUG=true`.

### Success Response

```json
{
  "status": "success",
  "chat_id": "550e8400-e29b-41d4-a716-446655440000",
  "branch_name": "feature/BP25-123",
  "working_dir": "/path/to/workspaces/BP25-123",
  "awaiting_user_input": true,
  "claude_response": { ... }
}
```

### Error Response

```json
{
  "status": "error",
  "error_code": 2,
  "error_message": "Failed to clone repository",
  "chat_id": "550e8400-e29b-41d4-a716-446655440000",
  "branch_name": "feature/BP25-123",
  "working_dir": "/path/to/workspaces/BP25-123"
}
```

## Exit Codes

| Code | Description |
|------|-------------|
| 0 | Success |
| 1 | Invalid parameters |
| 2 | Git operation failed |
| 3 | Claude execution failed |
| 4 | File/directory not found |

## Flow

### New Session (folder doesn't exist)

1. Validate inputs
2. Clone repo to `WORK_BASE_DIR/BRANCH_NAME/`
3. Create branch: `feature/BRANCH_NAME`
4. Run Claude with task description + system prompt (includes COMMIT_PREFIX)
5. Output JSON result with `awaiting_user_input` flag

### Continuation (folder exists)

1. Validate inputs
2. Verify folder is a git repository
3. Resume Claude session with user message
4. Output JSON result with `awaiting_user_input` flag

## n8n Integration

The `awaiting_user_input` field in the JSON response indicates whether Claude is waiting for user input. n8n workflows can use this flag to determine when to collect user input before continuing the session.

Claude is instructed to end responses with `AWAITING_USER_INPUT: true` when asking questions, which is automatically parsed into the JSON response.

## Project Structure

```
claude-remote/
├── bin/
│   └── benji-init.sh           # Main entry point
├── lib/
│   ├── common.sh               # Logging, validation, parsing
│   ├── git-operations.sh       # Git clone, branch operations
│   ├── claude-session.sh       # Claude Code invocation
│   └── output.sh               # JSON output formatting
├── config/
│   └── prompts/
│       └── benji-init.txt      # System prompt for Benji
└── CLAUDE.md                   # Claude Code context file
```

## Requirements

- Bash 4+
- Git
- Claude Code CLI (`claude`)
- jq (for JSON formatting)

## License

MIT
